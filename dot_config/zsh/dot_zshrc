# vim: ft=zsh :

# all of our zsh files
typeset -U config_files
config_files=($ZDOTDIR/*/conf.zsh)

# load completions functions
fpath+="$HOME/.config/zsh/plugins/zsh-completions/src"

plugins=(
  "zsh-utils/editor/*.plugin.zsh"
  "zsh-utils/history/*.plugin.zsh"
  "zsh-utils/directory/*.plugin.zsh"
  "zsh-autosuggestions/*.plugin.zsh"
  "zsh-utils/completion/*.plugin.zsh"
  "oh-my-zsh/plugins/git/*.plugin.zsh"
  "fast-syntax-highlighting/*.plugin.zsh"
)
for plugin in "${plugins[@]}"; do
  for f ($HOME/.config/zsh/plugins/$~plugin) source $f
done

# load everything but the path and init files
for file in ${config_files}; do
  source "$file"
done
unset config_files

# Load environment variables from a file; this approach allows me to not
# commit secrets like API keys to Git
# machine-specific configuraion
SYSTEM_ENV="$HOME/.local/share/hrndz/env"
[[ -e "$SYSTEM_ENV" ]] && source "$SYSTEM_ENV"

if [[ $TERM != "dumb" && (-z $INSIDE_EMACS || $INSIDE_EMACS == "vterm") ]]; then
  if (( $+commands[starship] )); then
    eval "$(starship init zsh)"
  fi
fi
