{{- if (eq .chezmoi.os "darwin") -}}
#!/bin/zsh
# vim: set ft=zsh :
{{ if stat ("/etc/yelp") }}
vpn_int=$(ifconfig -a inet | grep -B 1 "10.2" | grep utun | cut -d ":" -f 1)
if [[ -z $vpn_int ]]; then
  echo "AWS-OKTA: required connections not found, exiting..."
  exit
fi
aws_okta_path="$HOME/.local/bin/aws-okta"
if [[ ! -f "$aws_okta_path" ]]; then
  virtualenv_home="$HOME/.local/share/venvs"
  mkdir -p "$virtualenv_home"
  /usr/local/bin/python3 -mvenv "$virtualenv_home/aws-okta"
  source "$virtualenv_home/aws-okta/bin/activate"
  pip install -i https://pypi.yelpcorp.com/simple/ aws-okta
  ln -sf "$virtualenv_home/aws-okta/bin/aws-okta" $aws_okta_path
  deactivate
fi

GIT_FAT="$HOME/.local/bin/git-fat"
if [[ ! -f "$GIT_FAT" ]]; then
  echo "Downloading git-fat..."
  curl -sSL https://raw.githubusercontent.com/hurricanehrndz/git-fat/master/git-fat -o "$GIT_FAT"
  chmod +x "$GIT_FAT"
fi
{{ end }}
{{ end }}
