{{- if (eq .chezmoi.os "darwin") -}}
#!/bin/zsh
# vim: set ft=zsh :
brew_update_flag_path="$HOME/.local/share/hrndz/.update"
brew_update_flag=("$brew_update_flag_path"(Nmd+6))

if [[ -f "$HOME/.config/brewfile/Brewfile" ]]; then
  BREWFILE="$HOME/.config/brewfile/Brewfile"
else
  BREWFILE="$HOME/.local/share/chezmoi/dot_config/brewfile/src.Brewfile"
fi

if [[ ! -e "$brew_update_flag_path" ]] || [[ "$#brew_update_flag" -ge 1 ]]; then
  brew-file --leaves --on_request -f $BREWFILE install
  brew upgrade neovim --fetch-HEAD
  brew cu
  touch "$brew_update_flag_path"
fi
{{ end -}}
